<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SputnikChat - MudBall Arena</title>
    
    <!-- LIBRERIE ESTERNE -->
    <script src="https://unpkg.com/gifler@0.1.0/gifler.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Mappa Import per Three.js -->
    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }
    </script>

    <style>
        /* FONT */
        @font-face { font-family: 'Planewalker'; src: url('./Planewalker.woff') format('woff'); }
        * { box-sizing: border-box; }
        body { margin: 0; overflow: hidden; font-family: 'Planewalker', sans-serif; background: #111; user-select: none; }
        button, input { font-family: 'Planewalker', sans-serif; }
        
        /* LOGIN OVERLAY */
        #login-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 100; color: white;
        }
        #nickname-input { 
            padding: 15px; font-size: 24px; text-align: center; background-color: #222; color: #ffff00;
            border: 2px solid #555; border-radius: 8px; outline: none; width: 300px;
        }
        #play-btn { margin-top: 20px; padding: 10px 30px; font-size: 50px; cursor: pointer; background: transparent; color: #ffff00; border: none; }

        /* SCHEDA GIOCATORE (SCALATA) */
        #ui-container-wrapper { position: absolute; top: 10px; left: 10px; width: 300px; height: 400px; z-index: 20; pointer-events: none; }
        #ui-scale-wrapper { transform: scale(0.13); transform-origin: top left; width: 2106px; height: 2956px; pointer-events: auto; }
        
        .Texture {
            background-image: url("Texture.png"); background-color: #1a1a1a;
            border: 10px solid #111; border-radius: 40px; position: absolute; width: 100%; height: 100%;
            box-shadow: inset 0 0 0 20px rgba(255, 255, 255, 0.9), inset 0 0 20px 20px rgba(0,0,0,0.2);
        }
        .incassato {
            box-shadow: inset -6px 6px 12px rgba(0, 0, 0, 0.9), inset 3px -3px 6px rgba(255, 255, 255, 0.1), 0 2px 4px rgba(0,0,0,0.5);
            border: 2px solid #111;
        }
        
        .nome_giocatore {
            background-color: rgba(34, 32, 30, 0.6); position: absolute; left: 269px; top: 144px; width: 1560px; height: 212px;
            color: #ffff00; font-size: 140px; display: flex; align-items: center; justify-content: center;
        }
        .skin {
            background-color: rgba(34, 32, 30, 0.6); position: absolute; left: 269px; top: 411px; width: 1560px; height: 211px;
            color: #ccc; font-size: 100px; display: flex; align-items: center; justify-content: center;
        }
        .immagine {
            background-color: rgb(34, 32, 30); position: absolute; left: 270px; top: 694px; width: 1559px; height: 1560px;
            overflow: hidden; display: flex; align-items: center; justify-content: center;
        }
        .immagine img { width: 100%; height: 100%; object-fit: cover; }
        
        .skin-arrow {
            position: absolute; top: 0; bottom: 0; width: 200px; background: transparent; border: none; color: white;
            font-size: 150px; cursor: pointer; z-index: 10;
        }
        .skin-arrow:hover { background: rgba(255, 187, 0, 0.4); color: #ffff00; }
        .arrow-left { left: 0; } .arrow-right { right: 0; }

        .microfono, .musica {
            background-color: rgba(34, 32, 30, 0.6); position: absolute; top: 2326px; width: 752px; height: 492px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .microfono { left: 269px; } .musica { left: 1078px; }
        .microfono i, .musica i { font-size: 200px; color: #888; opacity: 0.5; }
        .active i { color: #00ff00; opacity: 1; }
        .music-on i { color: #0088ff; opacity: 1; }

        /* HUD MINIGIOCO (PUNTEGGIO) */
        #game-ui {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 20px; z-index: 50; pointer-events: none;
        }
        .hud-box {
            background: rgba(0, 0, 0, 0.7); border: 2px solid #555; padding: 10px 20px; border-radius: 10px;
            color: #ffff00; font-size: 24px; text-shadow: 2px 2px 0 #000; text-align: center;
        }
        #freeze-warning { color: #00ffff; display: none; }

        /* ISTRUZIONI & CHAT */
        #instructions {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; background: rgba(0, 0, 0, 0.7); padding: 20px; border-radius: 10px; z-index: 10; display: none; text-align: center;
        }
        #chat-container {
            position: absolute; bottom: 20px; right: 20px; width: 320px; height: 250px;
            background: rgba(0, 0, 0, 0.5); border-radius: 8px; z-index: 50; display: flex; flex-direction: column; padding: 10px; pointer-events: auto;
        }
        #chat-messages { flex-grow: 1; overflow-y: auto; color: white; font-size: 18px; margin-bottom: 5px; }
        .chat-name { color: #ffff00; margin-right: 5px; }
        #chat-input { background: rgba(255,255,255,0.1); border: 1px solid #555; color: white; padding: 8px; }
    </style>
</head>
<body>

    <div id="login-overlay" style="pointer-events: auto;">
        <h1 style="font-size: 50px;">MudBall Arena</h1>
        <input id="nickname-input" type="text" placeholder="Nickname" maxlength="12" autofocus>
        <button id="play-btn">ENTRA</button>
    </div>

    <!-- HUD Punteggio e Congelamento -->
    <div id="game-ui">
        <div class="hud-box">Punti: <span id="score-display">0</span></div>
        <div class="hud-box" id="freeze-warning">❄️ CONGELATO! ❄️</div>
    </div>

    <!-- Scheda Giocatore -->
    <div id="ui-container-wrapper">
        <div id="ui-scale-wrapper">
            <div class="Texture">
                <div class="nome_giocatore incassato" id="hud-name">PLAYER</div>
                <div class="skin incassato" id="skin-label">Skin: ...</div>
                <div class="immagine incassato">
                    <button class="skin-arrow arrow-left" id="prev-skin-btn">&lt;</button>
                    <img id="hud-propic" src="" alt="Profile">
                    <button class="skin-arrow arrow-right" id="next-skin-btn">&gt;</button>
                </div>
                <div class="microfono incassato" id="mic-btn"><i class="fa-solid fa-microphone-slash" id="mic-icon"></i></div>
                <div class="musica incassato" id="music-btn"><i class="fa-solid fa-music" id="music-icon"></i></div>
            </div>
        </div>
    </div>

    <div id="instructions">
        <h1>Comandi</h1>
        <p><b>WASD</b>: Muovi | <b>MOUSE</b>: Guarda<br><b>CLICK SX</b> o <b>F</b>: Spara Palla di Fango<br><b>INVIO</b>: Chat | <b>M</b>: Mic</p>
    </div>

    <div id="chat-container">
        <div id="chat-messages"></div>
        <input id="chat-input" type="text" placeholder="Scrivi..." autocomplete="off">
    </div>

    <!-- LINK AL FILE JS DEL GIOCO -->
    <script type="module" src="./game.js"></script>

</body>
</html>
